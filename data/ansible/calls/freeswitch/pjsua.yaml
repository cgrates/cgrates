---
- name:  Download and unarchive PJSIP
  become: yes
  unarchive:
    src: https://github.com/pjsip/pjproject/archive/refs/tags/2.9.tar.gz
    dest: /tmp
    remote_src: yes

- name:  Export CFLAGS
  become: yes
  shell: 'export CFLAGS="$CFLAGS -fPIC"'

- name:  Install PJSUA
  become: yes
  shell: 'sudo ./configure && make dep && make && make install'
  args:
    chdir: '/tmp/pjproject-2.9'

# - name:  Copy PJSUA into /usr/bin
#   become: yes
#   ansible.builtin.copy:
#     src: /tmp/pjproject-2.9/pjsip-apps/bin/pjsua-x86_64-unknown-linux-gnu
#     dest: /usr/bin/pjsua
#     remote_src: yes

- name:  Copy PJSUA into /usr/bin
  become: yes
  shell: 'sudo mv pjsua-x86_64-unknown-linux-gnu /usr/bin/pjsua'
  args:
    chdir: '/tmp/pjproject-2.9/pjsip-apps/bin'